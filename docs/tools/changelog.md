# Generate Changelog Tool

The `generate_changelog` tool automatically generates changelogs from GitHub pull requests and issues using [Anchore Chronicle](https://github.com/anchore/chronicle). It analyses git repositories and creates structured changelogs based on GitHub labels and semantic versioning.

## Overview

This tool provides AI agents with the ability to:
- Generate changelogs from GitHub PRs and issues between git tags/commits
- Automatically categorise changes based on GitHub labels (features, bugs, breaking changes)
- Support automatic semver version speculation based on change types
- Export changelogs in markdown and JSON formats
- Work with both public and private GitHub repositories

## Quick Start

```bash
# Generate changelog for current repository
mcp-devtools generate_changelog --repository_path=.

# Generate changelog between specific tags
mcp-devtools generate_changelog --repository_path=./my-project --since_tag=v1.0.0 --until_tag=v1.1.0

# Generate JSON changelog with version speculation
mcp-devtools generate_changelog --repository_path=. --output_format=json --speculate_next_version=true

# Save changelog to file
mcp-devtools generate_changelog --repository_path=. --output_file=CHANGELOG.md --title="Release Notes"
```

## Parameters

### Required Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `repository_path` | string | Path to local Git repository (e.g., `/path/to/repo`, `.`, or `./my-project`) |

### Optional Parameters

| Parameter                | Type    | Default       | Description                                             |
|--------------------------|---------|---------------|---------------------------------------------------------|
| `since_tag`              | string  | *auto-detect* | Starting git tag/commit for changelog range             |
| `until_tag`              | string  | `HEAD`        | Ending git tag/commit for changelog range               |
| `output_format`          | enum    | `markdown`    | Changelog output format (`markdown` or `json`)          |
| `speculate_next_version` | boolean | `false`       | Predict the next semantic version based on change types |
| `title`                  | string  | `Changelog`   | Title for the changelog document                        |
| `output_file`            | string  | *none*        | Optional file path to save changelog output             |
| `timeout_minutes`        | number  | `5`           | Maximum execution time in minutes                       |

## Examples

### Basic Usage

Generate a changelog for the current repository:

```json
{
  "name": "generate_changelog",
  "arguments": {
    "repository_path": "."
  }
}
```

### Version Range

Generate changelog between specific versions:

```json
{
  "name": "generate_changelog",
  "arguments": {
    "repository_path": "./my-project",
    "since_tag": "v2.0.0",
    "until_tag": "v2.1.0",
    "title": "What's New in v2.1.0"
  }
}
```

### JSON Output with Version Speculation

Get structured JSON output with next version prediction:

```json
{
  "name": "generate_changelog",
  "arguments": {
    "repository_path": ".",
    "output_format": "json",
    "speculate_next_version": true
  }
}
```

### Save to File

Generate and save changelog to a file:

```json
{
  "name": "generate_changelog",
  "arguments": {
    "repository_path": ".",
    "output_file": "RELEASE_NOTES.md",
    "title": "Release Notes",
    "since_tag": "v1.0.0"
  }
}
```

## Output Formats

### Markdown Format

The markdown format creates human-readable documentation with:
- Hierarchical structure with version and date information
- Changes grouped by type (Breaking Changes, Features, Bug Fixes, etc.)
- Links to PRs and commit information
- Author attribution

Example output:
```markdown
# Changelog

## v1.1.0 - 2024-01-15

**Repository**: https://github.com/owner/repo
**Changes**: https://github.com/owner/repo/compare/v1.0.0...v1.1.0

### Added Features

- Add dark mode support (by @user, [#42](https://github.com/owner/repo/pull/42))
- Implement user preferences (by @developer, commit a1b2c3d)

### Bug Fixes

- Fix login redirect issue (by @maintainer, [#38](https://github.com/owner/repo/pull/38))

---
*Generated by MCP DevTools generate_changelog tool*
```

### JSON Format

The JSON format provides structured data for programmatic processing:

```json
{
  "title": "Changelog",
  "version": "v1.1.0",
  "date": "2024-01-15",
  "timestamp": "2024-01-15T10:30:00Z",
  "repository": "https://github.com/owner/repo",
  "changes_url": "https://github.com/owner/repo/compare/v1.0.0...v1.1.0",
  "summary": {
    "total_changes": 15
  },
  "sections": [
    {
      "type": "added-feature",
      "title": "Added Features",
      "count": 8,
      "changes": [
        {
          "text": "Add dark mode support",
          "type": "added-feature",
          "commit": "a1b2c3d4e5f6",
          "author": "user",
          "pr_url": "https://github.com/owner/repo/pull/42",
          "issue_url": null
        }
      ]
    }
  ],
  "metadata": {
    "generator": "MCP DevTools generate_changelog",
    "generated": "2024-01-15T10:30:00Z"
  }
}
```

## GitHub Integration

### Authentication

The tool uses the same GitHub authentication pattern as the existing GitHub tool:

- `GITHUB_TOKEN`: GitHub personal access token (automatically detected)
- `GITHUB_AUTH_METHOD`: Optional authentication method preference (`token`, `ssh`, or `none`)

**Token Permissions Required:**
- Public repositories: `public_repo` scope (optional, improves rate limits)
- Private repositories: `repo` scope (required)

**Authentication Methods:**
- **Token**: Uses `GITHUB_TOKEN` environment variable (recommended)
- **SSH**: Uses SSH keys for git operations (API calls use unauthenticated access)
- **None**: Unauthenticated access (public repositories only, subject to rate limits)

### Repository Requirements

- Must be a valid git repository (contains `.git` directory)
- Must have GitHub as the origin remote
- Must have pull requests and/or issues for changelog generation

### Label-Based Categorisation

The tool categorises changes based on GitHub labels:

| Change Type             | GitHub Labels                                 | Semver Impact | Description               |
|-------------------------|-----------------------------------------------|---------------|---------------------------|
| **Breaking Changes**    | `breaking`, `backwards-incompatible`, `major` | Major         | API breaking changes      |
| **Security Fixes**      | `security`, `vulnerability`                   | Patch         | Security-related fixes    |
| **Added Features**      | `enhancement`, `feature`, `minor`             | Minor         | New functionality         |
| **Bug Fixes**           | `bug`, `fix`, `bug-fix`, `patch`              | Patch         | Bug fixes and corrections |
| **Deprecated Features** | `deprecated`                                  | Minor         | Feature deprecations      |
| **Removed Features**    | `removed`                                     | Major         | Removed functionality     |
| **Additional Changes**  | *(unlabelled)*                                | None          | Other changes             |

## Version Speculation

When `speculate_next_version` is enabled, the tool analyses change types to predict the next semantic version:

- **Major**: Breaking changes or removed features
- **Minor**: New features or deprecations (if no major changes)
- **Patch**: Bug fixes or security fixes (if no major/minor changes)

## Common Workflows

### Release Preparation

```json
{
  "name": "generate_changelog",
  "arguments": {
    "repository_path": ".",
    "speculate_next_version": true,
    "output_file": "CHANGELOG.md"
  }
}
```

### Version-Specific Changelog

```json
{
  "name": "generate_changelog",
  "arguments": {
    "repository_path": ".",
    "since_tag": "v2.0.0",
    "until_tag": "v2.1.0",
    "output_format": "markdown",
    "title": "v2.1.0 Release Notes"
  }
}
```

### CI/CD Integration

```json
{
  "name": "generate_changelog",
  "arguments": {
    "repository_path": ".",
    "output_format": "json",
    "output_file": "changelog.json",
    "timeout_minutes": 10
  }
}
```

## Troubleshooting

### Common Issues

**"Repository path is not a git repository"**
- Ensure the path points to a directory containing a `.git` folder
- Run `git init` if needed or verify the path is correct

**"Failed to extract GitHub info"**
- Verify the repository has a GitHub remote (`git remote -v`)
- Ensure the remote URL follows GitHub URL format

**"GitHub token authentication errors"**
- Set `GITHUB_TOKEN` environment variable
- Verify token has appropriate permissions for the repository

**"No changes found between tags"**
- Check that specified tags exist (`git tag -l`)
- Verify there are commits between the tags (`git log tag1..tag2`)

**"Timeout errors with large repositories"**
- Increase `timeout_minutes` parameter
- Focus on smaller commit ranges using `since_tag` and `until_tag`

### Rate Limiting

- Without a GitHub token: 60 requests/hour per IP
- With a GitHub token: 5,000 requests/hour
- Private repositories require authentication

## Configuration

### Environment Variables

| Variable                    | Purpose                          | Example                   |
|-----------------------------|----------------------------------|---------------------------|
| `GITHUB_TOKEN`              | GitHub API authentication        | `ghp_xxxxxxxxxxxx`        |
| `GITHUB_AUTH_METHOD`        | Authentication method preference | `token`, `ssh`, or `none` |
| `CHANGELOG_DEFAULT_TIMEOUT` | Default timeout in minutes       | `10`                      |

### Repository Setup

For best results, ensure your GitHub repository follows these practices:

1. **Consistent Labelling**: Use consistent labels on PRs and issues
2. **Descriptive PR Titles**: Clear, concise pull request titles
3. **Semantic Versioning**: Use semantic version tags (`v1.2.3`)
4. **Regular Tagging**: Tag releases consistently for better range detection

## Limitations

- **GitHub Dependency**: Requires GitHub-hosted repositories
- **Label Dependency**: Effectiveness depends on consistent labelling
- **Network Dependency**: Requires internet access for GitHub API
- **Git Repository**: Must be run within or pointed to a git repository

## Integration with Other Tools

The changelog tool works well with other MCP DevTools in release workflows:

```bash
# Complete release pipeline
generate_changelog . --output-file CHANGELOG.md --speculate-next-version
sbom /path/to/image --output-file sbom.json
vulnerability_scan sbom:sbom.json --output-file vulns.json
```

## Best Practices

1. **Start Simple**: Use default parameters before customising
2. **Regular Generation**: Generate changelogs regularly, not just at release time
3. **Consistent Labels**: Maintain consistent GitHub labelling practices
4. **Version Control**: Commit generated changelogs to version control
5. **Automation**: Integrate into CI/CD pipelines for automated documentation
